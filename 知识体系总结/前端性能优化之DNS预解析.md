### 前端优化DNS预解析

> **写在前面**
> 
> 今天看到淘宝、京东网站的源码时，发现了这样的`<link rel="dns-prefetch" href="//static.360buyimg.com">`代码，很好奇查了一下才知道，`dns-prefetch`链接用于使得用户代理尽可能早的解析，可以提高网页的载入速度。

### 背景

在前端优化中与DNS的有关一般有两点：一个是减少DNS的请求次数，另一个就是进行DNS预获取。DNS作为互联网的基础协议，往往容易被网站优化人员忽略。

### DNS与域名解析

DNS全名 Domain Name System，即域名系统，是域名和IP地址相互映射的一个分布式数据库。

域名解析即通过主机名，最终得到该主机对应的IP地址的过程。

浏览器对网站第一次的域名DNS解析查找流程依次为：

浏览器缓存 - 系统缓存 - 路由缓存 - ISP DNS 缓存 - 递归搜索

### 解决方案

DNS 预解析是浏览器试图在用户访问链接**之前**解析域名，这是计算机的正常DNS解析机制。

域名解析后，如果用户确实访问该域名，那么DNS解析时间将不会有延迟。

遇到网页中的超链接，DNS prefetching 从中提取到域名并将其解析为IP地址，这些工作在用户浏览网页时，使用最少的CPU和网络在后台进行解析。

当用户点击这些已经预解析的域名时，可以平均减少200ms耗时。（假设用户最近还未访问过该域名）


### DNS Prefetching 简介

DNS 请求需要的**带宽非常小**，但是**延迟却有点高**，这点在手机网络上特别明显，而一次典型的DNS解析一般需要20-200ms，所以DNS预解析可以让延迟明显减少一些。

在某些浏览器中这个预读取的行为将会与页面的实际内容并行发生（而不是串行）。正因为如此，某些高延迟的域名的解析过程才不会卡住资源的加载。

这样可以极大的加速（尤其是移动网络环境下）页面的加载。在某些图片较多的页面中，在发起图片加载请求之前预先把域名解析好将会有至少5%的图片加载速度提升。

### 使用

```
    // 打开和关闭DNS预读取
    <meta http-equiv="x-dns-prefetch-control" content="off">
    <meta http-equiv="x-dns-prefetch-control" content="on">
    // 强制查询特定主机名
    <link rel="dns-prefetch" href="//hm.baidu.com">
```